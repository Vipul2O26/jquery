<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Comments App</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

</head>

<body>

<div class="container mt-5">

  <!-- FORM -->
  <div class="card">
    <div class="card-title text-center fs-4 mt-2">Add your comments</div>

    <div class="card-body">
      <form id="formId">

        <div class="row g-3">

          <div class="col-md-6">
            <label>Name</label>
            <input type="text" id="name" class="form-control border-info">
            <small class="text-danger d-none" id="nameInput"></small>
          </div>

          <div class="col-md-6">
            <label>Email</label>
            <input type="email" id="email" class="form-control border-info">
            <small class="text-danger d-none" id="emailInput">Invalid email</small>
          </div>

          <div class="col-12">
            <label>Comment</label>
            <input type="text" id="comment" class="form-control border-info">
            <small class="text-danger d-none" id="commentInput">Comment required</small>
          </div>

          <div class="col-12 text-center">
            <button class="btn btn-warning" id="submit">Submit</button>
          </div>

        </div>

      </form>
    </div>
  </div>

  <!-- COMMENTS -->
  <div class="card mt-3">
    <div class="card-title fs-5 p-2">Comments from users</div>
    <div class="comment p-2"></div>
  </div>

</div>

<script>

$(document).ready(function(){

$("#formId").submit(function(e){
  e.preventDefault();
});

// Name validation
$("#name").on("keyup blur",function(){
  let v=$(this).val().trim();
  if(v.length<3){
    $("#nameInput").removeClass("d-none").text("Name must be 3+ chars");
    $(this).addClass("border-danger");
  }else{
    $("#nameInput").addClass("d-none");
    $(this).removeClass("border-danger").addClass("border-success");
  }
});

// Email
$("#email").on("keyup blur",function(){
  let r=/^([_\-\.0-9a-zA-Z]+)@([_\-\.0-9a-zA-Z]+)\.([a-zA-Z]{2,5})$/;
  if(!r.test($(this).val())){
    $("#emailInput").removeClass("d-none");
    $(this).addClass("border-danger");
  }else{
    $("#emailInput").addClass("d-none");
    $(this).removeClass("border-danger").addClass("border-success");
  }
});

// Comment
$("#comment").on("keyup blur",function(){
  if($(this).val().trim()==""){
    $("#commentInput").removeClass("d-none");
    $(this).addClass("border-danger");
  }else{
    $("#commentInput").addClass("d-none");
    $(this).removeClass("border-danger").addClass("border-success");
  }
});

// ADD COMMENT
$("#submit").click(function(){

let name=$("#name").val().trim();
let email=$("#email").val().trim();
let comment=$("#comment").val().trim();

if(name==""||email==""||comment=="") return;

let html=`
<div class="card p-2 mt-2 comment-card">
<h6 class="username">${name}</h6>
<small class="useremail">${email}</small>
<p class="usercomment mt-2">${comment}</p>

<div class="text-end">
<button class="btn btn-sm btn-info edit">Edit</button>
<button class="btn btn-sm btn-danger delete">Delete</button>
</div>
</div>`;

$(".comment").append(html);

$("#name,#email,#comment").val("").removeClass("border-success");

});

// DELETE
$(document).on("click",".delete",function(){
$(this).closest(".comment-card").remove();
});

// EDIT
$(document).on("click",".edit",function(){

let card=$(this).closest(".comment-card");

$("#name").val(card.find(".username").text());
$("#email").val(card.find(".useremail").text());
$("#comment").val(card.find(".usercomment").text());

card.remove();

});

});

</script>

</body>
</html>
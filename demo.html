<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>jQuery CRUD Table</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<style>
  .editable {
    background: #fff3cd;
  }
</style>
</head>

<body class="p-4">

<div class="container">

  <h3 class="mb-3">jQuery CRUD Table</h3>

  <!-- Alert -->
  <div id="alertBox" class="alert d-none"></div>

  <!-- Inputs -->
  <div class="row mb-3">
    <div class="col">
      <input id="name" class="form-control" placeholder="Name">
    </div>
    <div class="col">
      <input id="email" class="form-control" placeholder="Email">
    </div>
    <div class="col">
      <button id="addBtn" class="btn btn-success">Add</button>
    </div>
  </div>

  <!-- Table -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody id="tbody">
    </tbody>
  </table>

</div>

<script>
$(document).ready(function(){

  function showAlert(msg,type){
    $("#alertBox")
      .removeClass("d-none alert-success alert-danger alert-info")
      .addClass("alert-"+type)
      .text(msg)
      .fadeIn();

    setTimeout(()=>{
      $("#alertBox").fadeOut();
    },3000);
  }

  // ================= ADD =================
  $("#addBtn").click(function(){

    let name = $("#name").val().trim();
    let email = $("#email").val().trim();

    if(name=="" || email==""){
      showAlert("Name & Email required","danger");
      return;
    }

    // Duplicate name check
    if($("#tbody td:first-child:contains('"+name+"')").length){
      showAlert("Name already exists","danger");
      return;
    }

    let row = `
      <tr>
        <td>${name}</td>
        <td>${email}</td>
        <td>
          <button class="btn btn-warning btn-sm edit">Edit</button>
          <button class="btn btn-danger btn-sm delete">Delete</button>
        </td>
      </tr>
    `;

    $("#tbody").append(row);

    $("#name").val("");
    $("#email").val("");

    showAlert("Row added successfully","success");
  });

  // ================= EDIT / UPDATE =================
  $("#tbody").on("click",".edit",function(){

    let btn = $(this);
    let row = btn.closest("tr");

    if(btn.text()=="Edit"){

      row.children("td").eq(0).attr("contenteditable",true).addClass("editable");
      row.children("td").eq(1).attr("contenteditable",true).addClass("editable");

      btn.text("Update").removeClass("btn-warning").addClass("btn-info");

    }else{

      let newName = row.children("td").eq(0).text().trim();
      let newEmail = row.children("td").eq(1).text().trim();

      if(newName=="" || newEmail==""){
        showAlert("Fields cannot be empty","danger");
        return;
      }

      // Duplicate check excluding current row
      let duplicate=false;
      $("#tbody tr").not(row).each(function(){
        if($(this).children("td").eq(0).text()==newName){
          duplicate=true;
        }
      });

      if(duplicate){
        showAlert("Duplicate name not allowed","danger");
        return;
      }

      row.children("td").removeAttr("contenteditable").removeClass("editable");

      btn.text("Edit").removeClass("btn-info").addClass("btn-warning");

      showAlert("Row updated","info");
    }

  });

  // ================= DELETE =================
  $("#tbody").on("click",".delete",function(){

    $(this).closest("tr").fadeOut(function(){
      $(this).remove();
    });

    showAlert("Row deleted","info");
  });

});
</script>

</body>
</html>
